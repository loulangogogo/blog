## 数据库系统章节概述【302】

- 数据库模式
- **分布式数据库**
- 数据库设计阶段
- 概念结构设计-ER 模型
- 逻辑结构设计-关系模型
- **关系代数**
- **规范化理论**
- 并发控制
- 数据库的安全性
- 数据库备份与恢复技术
- 数据库性能优化



## 数据库模式【303】

#### 外模式

- 用户视图

#### 概念模式

- 概念级数据库
- 基本表

#### 内模式

- 也成为存储模式，物理模式
- 数据库具体的存储文件



### 关系表类型

#### 关系的3中类型

- 基本关系（通常称为基表或基本表）：实际存在的表，实际存储数据的逻辑表示。
- 查询表：查询结果对应的表
- 视图表：有基表或其他视图表到处的表，本身不堵里存储，数据库只存放它的定义，常称为虚表



### 数据库模式

#### 数据库视图

> 它一个虚拟表（逻辑上的表），其内容有查询定义（仅保存 SQL 查询语句）。

#### 视图的优点：

- 视图能简化用户操作
- 视图使用户能以多种角度看待同一数据
- 视图对重构数据库提供了一定程度的逻辑独立性
- 视图可以对机密数据提供安全保护

#### 物化视图：

> 它不是传统意义上的虚拟视图，是实体化视图，其本身会存储数据。同时当原始表中的数据更新的时候，物化视图也会进行更新。



## 分布式数据库【304】

- **数据库独立性**：除了数据的逻辑独立性与物理独立性外，还有数据分布独立性（分布透明性）。
- 集中于自治共享结合的控制结构。
- 适当增加数据冗余度
- 全局的一致性，可串行性



## 数据库设计过程【305】

#### 1. 需求分析

- 数据流图
- 数据字典
- 需求说明书

#### 2. 概念结构设计

- ER 模型

#### 3. 逻辑结构设计

- 关系模式

#### 4. 物理设计



## 概念结构设计【306】

## 概念结构设计例题【307】

- 属性冲突
- 结构冲突
- 命名冲突
- 实体冲突



## 关系模型基本概念【308】

> 数据模型三要素：数据结构、数据操作、数据的约束条件

- 层次模型
- 网状模型
- 面向对象模型
- 关系模型

#### 关系模型相关概念

- 目或度：关系模式中属性的个数
- 候选码（候选键）：唯一标识元祖，且无冗余
- 主码（主键）：任选一个候选码作为主键
- 主属性与非主属性：组成候选码的属性就是主属性，其他的就是非主属性。
- 外码（外键）：其他关系的主键
- 全码：关系模式的属性属性组就是这个关系的候选码。



#### 完整性约束

- 实体完整性约束：规定基本关系的主属性不能取空值。
- 参照完整性约束：关系与关系键的应用，其他关系的主键或空值
- 用户自定义完整性约束：应用环境决定。

 

## 关系模型基本概念例题补充【309】

## 逻辑结构设计【310】

```mermaid
flowchart LR
A[概念设计] --> b[转化为数据模型] --> c[关系泛化] --> d[模式优化] --> e[设计用户子模式] --> f[物理设计]
```

- E-R 图向关系模式的转换
- 关系模式规范化
  - 实体转换为关系模式
  - 联系转换为关系模式
- 确定完整性约束（保证数据的正确性）
- 用户视图的确定
- 应用程序设计

## 关系代数【311】

### 基本数据

#### R

| A    | B    | C    |
| ---- | ---- | ---- |
| 1    | 2    | 3    |
| 3    | 5    | 6    |
| 7    | 8    | 9    |

#### S

| A    | D    |
| ---- | ---- |
| 1    | 1    |
| 2    | 2    |

#### K

| A    | B    | C    |
| ---- | ---- | ---- |
| 11   | 21   | 31   |
| 3    | 5    | 6    |



### 关系处理

#### 并

```math
\large
R \cup K
```

> **要求：**
>
> - 相同的属性集：必须具有相同的属性（列）集
> - 相同的数据类型：对应属性的数据类型必须相同

| A    | B    | C    |
| ---- | ---- | ---- |
| 1    | 2    | 3    |
| 3    | 5    | 6    |
| 7    | 8    | 9    |
| 11   | 21   | 31   |

> 这个操作类似 SQL 中的`union`操作，可以自动去掉重复的数据（元组）。
>
> 如果希望保留重复的元组，可以使用 `union all`



#### 交

```math
\large
R \cap K
```

> **要求：**
>
> - 相同的属性集：必须具有相同的属性（列）集
> - 相同的数据类型：对应属性的数据类型必须相同

| A    | B    | C    |
| ---- | ---- | ---- |
| 3    | 5    | 6    |

> SQL 中可以使用 `INTERSECT`来实现这个操作。
>
> ```sql
> SELECT A, B FROM R
> INTERSECT
> SELECT A, B FROM K;
> ```



#### 差

```math
\large
R - K
```

> **要求：**
>
> - 相同的属性集：必须具有相同的属性（列）集
> - 相同的数据类型：对应属性的数据类型必须相同

| A    | B    | C    |
| ---- | ---- | ---- |
| 1    | 2    | 3    |
| 7    | 8    | 9    |

> SQL 中可以使用 `EXCEPT`来实现差集。
>
> ```sql
> SELECT A, B FROM R
> EXCEPT
> SELECT A, B FROM K;
> ```



#### 笛卡尔积

```math
\large
R \times S
```

| R.A  | R.B  | R.C  | S.A  | S.D  |
| ---- | ---- | ---- | ---- | ---- |
| 1    | 2    | 3    | 1    | 1    |
| 1    | 2    | 3    | 2    | 2    |
| 3    | 5    | 6    | 1    | 1    |
| 3    | 5    | 6    | 2    | 2    |
| 7    | 8    | 9    | 1    | 1    |
| 7    | 8    | 9    | 2    | 2    |

> 就是将两张表的数据交叉组合起来。
>
> SQL 表示如下：
>
> ```sql
> SELECT * FROM R, S;
> ```



#### 投影

```math
\large
\pi_{A, B}(R)
```

> 投影就是从表中指定的列提取出来。

| A    | B    |
| ---- | ---- |
| 1    | 2    |
| 3    | 5    |
| 7    | 8    |

> SQL 表示如下：
>
> ```sql
> SELECT A, B FROM R;
> ```



#### 选择

```math
\large
\sigma_{A=1}(R)
```

> 选择就是选择具体的元组，筛选元组。

| A    | B    | C    |
| ---- | ---- | ---- |
| 1    | 2    | 3    |

> SQL 表示如下（就是条件）
>
> ```sql
> SELECT * FROM R WHERE A=1;
> ```



#### 连接

```math
\large
R \bowtie S
```

> **自然连接**（Natural Join）是一种关系代数操作，用于将两个关系（表）基于它们共有的属性（列）进行连接，生成一个新的关系。自然连接会自动匹配两个关系中相同属性名的值，并去除重复的属性。

| A    | B    | C    | D    |
| ---- | ---- | ---- | ---- |
| 1    | 2    | 3    | 1    |

> SQL 表示如下：
>
> ```sql
> SELECT * FROM R NATURAL JOIN S;
> ```



## 非规范化存在的问题【132】

- 非规范化的关系模式，可能存在的问题包括：数据冗余、更新异常（修改操作一致性问题）、插入异常、删除异常。



## 规范化理论基本概念【133】

### 函数依赖

- 部分函数依赖
- 传递函数依赖

### 键（求候选键）



## 公理系统【134】

> - 自反律
> - 增广律
> - 传导律

> 推理规则
>
> - 合并规则
> - 伪传递规则
> - 分解规则



## 范式判断【135】

#### 1NF

> 属性值都是补课分的原子值

#### 2NF

> 消除非主属性对候选键的部分依赖

#### 3NF

> 消除非主属性对候选键的传递依赖

#### BCNF

> 消除非主属性对候选键的部分依赖和传递依赖



## 模式分解【136】

- 保持函数依赖
- 无损连接（拆解后能子）

