## 数据库设计

### 一、数据库设计的基本步骤

#### (一)、数据库设计的六个步骤

1. **用户需求分析**：数据库设计人员采用一定的辅助工具对应用对象的功能、性能、限制 等要求进行科学的分析。
2. **概念结构设计**：概念结构设计是对信息分析和定义，如视图模型化、视图分析和汇总。 对应用对象精确地抽象、概括而形成独立于计算机系统的企业信息模型。描述概念模型的较理 想的工具是 E - R 图。
3. **逻辑结构设计**：将抽象的概念模型转化为与选用的 DBMS 产品所支持的数据模型相符 合的逻辑模型，它是物理结构设计的基础。包括模式初始设计、子模式设计、应用程序设计、模式评价以及模式求精。
4. **物理结构设计**：是逻辑模型在计算机中的具体实现方案。
5. **数据库实施阶段**：数据库设计人员根据逻辑设计和物理设计阶段的结果建立数据库，编制与调试应用程序，组织数据入库，并进行试运行。
6. **数据库运行和维护阶段**：数据库应用系统经过试运行即可投入运行，但该阶段需要不断地对系统进行评价、调整与修改。



### 二、数据需求分析

#### (一)、需求分析阶段的任务

> 综合各个用户的应用需求，对现实世界要处理的对象(组织、部门 和企业等)进行详细调查，在了解现行系统的概况，确定新系统功能的过程中，收集支持系统目标的基础数据及处理方法。

#### (二)、需求分析的参与者

> 参与需求分析的主要人员是分析人员和用户，由于数据库应用系统是面向企业和部门的具体业务，分析人员一般并不了解，而同样用户也不会具有系统分析的能力，这就需要双方进行 有效的沟通，使得设计人员对用户的各项业务了解和熟悉，进行分析和加工，将用户眼中的业 务转换成为设计人员所需要的信息组织。

#### (三)、分析和表达用户需求的方法（结构化分析方法 SA ）

> 分析和表达用户需求的方法主要包括自顶向下和自底向上两类方法。自顶向下的结构化分析 (Structured Analysis,SA) 方法从最上层的系统组织机构入手，采用逐层分解的方式分析系 统，并把每一层用数据流图和数据字典描述。需求分析的重点是调查组织机构情况、调查各部 门的业务活动情况、协助用户明确对新系统的各种要求、确定新系统的边界，以此获得用户对 系统的如下要求:
>
> - 信息要求
> - 处理要求
> - 系统要求



### 三、概念结构设计

#### (一)、E-R 方法

> 概念结构设计最著名最常用的方法是PPS Chen于1976年提出的实体-联系方法 (Entity- Relationship Approach), 简称E-R方法。它采用E-R模型将现实世界的信息结构统一由实体、 属性，以及实体之间的联系来描述。使用 E-R 方法，对现实事物加以抽象认识，以 E-R 图的形 式描述出来。对现实事物抽象认识的3种方法分别是分类、聚集和概括。分类 (Classification):对现实世界的事物，按照其具有的共同特征和行为，定义一种类型。聚集 (Aggregation): 定义 某一类型所具有的属性。概括 (Generalization): 由一种已知类型定义新的类型。通常把已知类 型称为超类 (Superclass), 新定义的类型称为子类 (Subclass)。 

#### (二)、设计步骤（选择局部应用、逐一设计分 E-R 图、E-R 图合并）

1. **选择局部应用**
2. **逐一设计分 E-R 图**
3. **E-R图合并**



### 四、逻辑结构设计

#### (一)、E-R 转化为关系模式、关系模式规范化、完整性约束、确定用户视图、反规范化

1. **E-R 转化为关系模式**

   > E - R 图方法所得到的全局概念模型是对信息世界的描述，并不适用于计算机处理，为适合 关系数据库系统的处理，必须将E-R图转换为关系模式。 E-R图是由实体、属性和联系三要素构成的，而关系模型中只有唯一的结构——关系模式，通常采用下述方法加以转换。
   >
   > 1. 将 E - R 图中的实体逐一转换成为一个关系模式，实体名对应关系模式的名称，实体的属性转换为关系模式的属性，实体标识符就是关系的码。
   > 2. E-R 图中的联系有3种
   >    - 一对一
   >    - 一对多
   >    - 多对多

2. **关系模式规范化**

   > 由E - R 图转换得来的初始关系模式并不能完全符合要求，还会有数据冗余、更新异常存在， 这就需要经过进一步的规范化处理，具体步骤如下。
   >
   > - 根据语义确定各关系模式的数据依赖。
   > - 根据数据依赖确定关系模式的范式。
   > - 如果关系模式不符合要求，要根据关系模式的分解算法对其进行分解，使其达到3N F 或 BCNF。
   > - 关系模式的评价及修正。

3. **确定完整性约束**

   > 根据规范化理论确定了关系模式之后，还要对关系模式加以约束，包括数据项的约束、表 级约束及表间约束，可以参照 SQL 标准来确定不同的约束，如检查约束、主码约束、参照完整 性约束，以保证数据的正确性。

4. **确定用户视图**

   > 确定了整个系统的关系模式之后，还要根据数据流图及用户信息建立视图模式，提高数据 的安全性和独立性。
   >
   > - 根据数据流图确定处理过程使用的视图。
   > - 根据用户类别确定不同用户使用的视图。

5. **反规范化**

   > 在关系模式的规范化过程中，会导致关系的概念愈来愈单一化，在响应用户查询时，往往需要涉及多表的关联操作，导致查询性能下降。为此需要对关系模式进行修正，对部分影响性 能的关系模式进行处理，包括分解、合并、增加冗余属性等。
   >
   > 这种修正称之为反规范化设计，反规范化 (Denormalization) 是加速读操作性能(数据检 索)的方法，一般用这种方法有选择地在数据结构标准化后添加特定的冗余数据实例。反规范 化数据库不应该与从未进行过标准化的数据库相混淆。常见的反规范化操作由冗余列、派生列、 表重组和表分割，其中表分割又分为水平分割和垂直分割。
   
   

### 五、物理设计

#### (一)、设计步骤（确定数据分布、确定数据存储结构、确定访问方式）

1. **确定数据分布**

   - 根据不同应用分布数据。
   - 根据处理要求确定数据的分布。
   - 对数据的分布存储必然会导致数据的逻辑结构的变化，要对关系模式作新的调整，需 要回到数据库逻辑设计阶段作必要的修改。

2. **确定数据存储结构**

   存储结构具体指数据文件中记录之间的物理结构。在文件中，数据是以记录为单位存储的， 可以采用顺序存储、哈希存储、堆存储和 B 树存储等方式。在实际应用中，要根据数据的处理 要求和变更频度选定合理的物理结构。
   为提高数据的访问速度，通常会采用索引技术。在物理设计阶段，要根据数据处理和修改 要求，确定数据库文件的索引字段和索引类型。

3. **确定数据的访问方式**

   - 存储记录结构设计
   - 存储记录布局
   - 存取方法的设计

   

### 六、数据库实施设计

#### (一)、确定数据库结构（模式与子模式、完整性描述、安全性描述和存储参数描述）

- **数据库模式与子模式，以及数据库空间等的描述**：例如，在 Oracle 系统中，数据库 逻辑结果的描述包括表空间 (Tablespace)、 段 (Segment)、 范围 (Extent) 和数据块 (Data block)。
- **数据库完整性描述**：所谓数据的完整性，是指数据的有效性、正确性和一致性。
- **数据库安全性描述**：数据安全性设计同数据完整性设计一样，也应在数据库设计的各 个阶段加以考虑。
- **数据库物理存储参数描述**：物理存储参数因 D B M S 的不同而不同。一般可设置的参数包括块大小、页面大小(字节数或块数)、数据库的页面数、缓冲区个数、缓冲区大小和用户数 等。

#### (二)、数据加载（手工录入、数据转换工具）

> 数据加载分为手工录入和使用数据转换工具两种。现有的D B M S 都提供了D B M S之间数 据转换的工具。如果用户原来就使用数据库系统，可以利用新系统的数据转换工具。先将原系 统中的表转换成新系统中相同结构的临时表，然后对临时表中的数据进行处理后插入到相应表 中。数据加载是一项费时费力的工作。另外，由于还需要对数据库系统进行联合调试，所以大 部分的数据加载工作应在数据库的试运行和评价工作中分批进行。

#### (三)、试运行和评价目录、测试要求

>当加载了部分必须的数据和应用程序后，就可以开始对数据库系统进行联合调试，称为数 据库的试运行。一般将数据库的试运行和评价结合起来的目的是测试应用程序的功能;测试数 据库的运行效率是否达到设计目标，是否为用户所容忍。测试的目的是为了发现问题，而不是 为了说明能达到哪些功能。所以，测试中一定要有非设计人员的参与。
>
>用户数据可能是以前旧系统的数据，并不完全满足新系统的数据要求，需要进行处理，同 时还要做好新系统的数据库的转储和恢复工作，以免发生故障时丢失数据。



### 七、数据库运行维护

#### (一)、运行维护目的、要求和意义

> 数据库一旦投入运行，就标志着数据库维护工作的开始。数据库维护工作的主要内容包括 对数据库性能的监测和改善、故障恢复、数据库的重组和重构。在数据库运行阶段，对数据库 的维护主要由DBA完成。

#### (二)、性能的检测和改善

> 性能可以用处理一个事务的 I/O 量、 C P U 时间和系统响应时间来度量。由于数据库应用环 境、物理存储的变化，特别是用户数和数据量的不断增加，数据库系统的运行性能会发生变化。 某些数据库结构(如数据页和索引)经过一段时间的使用以后，可能会被破坏。所以， D B A必 须利用系统提供的性能监控和分析工具，经常对数据库的运行、存储空间及响应时间进行分析，结合用户的反映确定改进措施。目前的D B M S都提供一些系统监控或分析工具。例如，在SQL Server 中使用 SQL Server Profiler 组件、Transaction-SQL 工具和 Query Analyzer 组件等都可进行 系统监测和分析。

#### (三)、备份及故障恢复（备份方案）

> 数据库是企业的一种资源，所以在数据库设计阶段， D B A应根据应用要求制定不同的备份 方案，保证一旦发生故障能很快地将数据库恢复到某种一致性状态，尽量减少损失。数据库的 备份及故障恢复方案，一般基于 D B M S 提供的恢复手段。

#### (四)、重组和重构

> 数据库运行一段时间后，由于记录的增、删、改，数据库物理存储碎片记录链过多，影响 数据库的存取效率。这时，需要对数据库进行重组和部分重构。数据库的重组是指在不改变数 据库逻辑和物理结构的情况下，去除数据库存储文件中的废弃空间以及碎片空间中的指针链， 使数据库记录在物理上紧连。