## 面向服务的架构设计

### 一、SOA的设计原则

- 无状态
- 单一实例
- 明确定义的接口
- 自包含和模块化
- 粗粒度
- 服务之间的松耦合性
- 重用能力
- 互操作性

### 二、SOA的设计模式

- **服务注册表模式**

  > 服务注册表主要在SOA设计时段使用，虽然它们常常也具有运行时段的功能。注册表支持驱动SOA治理的服务合同、策略和元数据的开发、发布和管理。因此它们提供了一个主控制点，或者称为策略执行点。在这个点上，服务可以在SOA中注册和被发现。

  > [!TIP]
  >
  > 大多数商用服务注册产品支持下面的SOA治理功能：
  >
  > - **服务注册**：应用开发者，也叫服务提供者，向注册表公布它们的功能。
  > - **服务位置**：也就是服务应用开发者，帮助他们查询注册服务，寻找符合自身要求的服务。
  > - **服务绑定**：服务的消费者利用检索到的服务合同来开发代码，开发的代码将于注册的服务绑定、调用注册的服务以及与它们实现互动。

- **企业服务总线模式**

  > 在企业基于SOA实施EAI、B2B和BMP的过程中，如果采用点对点的集成方式存在着复杂度高，可管理性差，复用度差和系统脆弱等问题。
  >
  > 企业服务总线技术在这种背景下产生，其思想是提供一种标准的软件低层架构，各种程序组件能够以服务单元的方式“插入”到该平台上运行，并且组件之间能够以标准的消息通信方式来进行交互。
  >
  > 它的定义通常如下：企业服务总线是由中间件技术实现的支持面向服务架构的基础软件平台，支持异构环境中的服务以基于消息和时间驱动模式的交互，并且具有适当的服务质量和可管理性。

  > [!TIP]
  >
  > ESB本质上是以中间件形式支持服务单元之间进行交互的软件平台。ESB的核心功能如下：
  >
  > - 提供位置透明性的消息路由和寻址服务。
  > - 提供服务注册和命名的管理功能。
  > - 支持多种消息传递泛型（如请求/响应、发布/订阅）。
  > - 支持多种可以广泛使用的传输协议。
  > - 支持多种数据格式及其相互交换。
  > - 提供日志和监控功能。

- **微服务模式**

  > SOA的架构中，复杂的ESB企业服务总线依然处于非常重要的位置，整个系统的架构并非没有实现完全的组件化以及面向服务，它的学习和使用门槛依然偏高。而微服务不再强调传统SOA架构里面比较重的ESB企业服务总线，同时SOA的死啊想进入到单个业务系统内部实现真正的组件化。
  
  - **服务架构概述**
  
    > 微服务架构将一个大型的单个应用拆分成多个微服务，可扩展单个组件而不是整个应用程序堆栈，从而满足服务等级协议。微服务架构围绕业务领域将服务进行拆分，每个服务可以独立进行开发、管理和迭代，彼此之间使用统一接口进行交流，实现了在分散组件中的部署、管理和服务能力，是产品交付变得更加简单，从而达到有效拆分应用，实现敏捷开发与部署的目的。
    >
    > - 负载应用解耦
    > - 独立
    > - 技术选型灵活
    > - 容错
    > - 松耦合、易扩展
  
  - 微服务架构模式方案
  
    > 微服务是一种软件架构演变后的新型架构风格，是系统应用开发的一种设计思想，没有固定的开发模式。开发团队可根据企业实际业务场景进行架构设计，提现了微服务架构的灵活性。常见微服务模式如下：
    >
    > - 聚合器微服务
    > - 链式微服务
    > - 数据共享微服务
    > - 异步消息传递微服务
  
  - 微服务架构面临的问题与挑战
  
    > - 需要基于RPC或消息实现微服务之间的调用与通信，是服务发现与服务调用链跟踪变得空难。
    > - 每个微服务可能使用不同的数据库，受限于CAP原理的约束，不得不放弃传统数据的强一致性，转而追求最终一致性。
    > - 测试部署等需要启动一堆服务，使得复杂性变高。

### 三、设计SOA架构应注意的问题

- 服务粒度的控制
- 无状态服务的设计
